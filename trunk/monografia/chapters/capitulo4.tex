\chapter{Construção da Mesa Multi-toque}
\label{cap4}
Este capítulo apresenta o projeto, a construção e a montagem da mesa multi-toque concebida como plataforma de execução do \textit{software Deskworld} proposto neste trabalho. Para iluminação da superfície da mesa e reconhecimento dos toques utilizou-se o método \textit{FTIR}.

\section{Estrutura da Mesa}
\label{cap4.1}

\begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=0.6]{projetomesa.png}
	\caption{Projeto da mesa com superfície multi-toque construída neste trabalho.}
	\label{mesa}
	\end{center}
\end{figure}

\begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=0.6]{mesalateral.png}
	\caption{Visão lateral do projeto da mesa com superfície multi-toque construída neste trabalho.}
	\label{mesalateral}
	\end{center}
\end{figure}

A estrutura da mesa é feita de alumínio como material principal, de modo a prover estabilidade, leveza e mobilidade, sem prejudicar sua eficiência. Sua confecção foi sob medida, pois cada elemento influi na sua configuração. As dimensões da mesa estão inclusas na Figura~\ref{mesa} que apresenta o projeto da mesa. Visão de dentro e lateral do projeto da mesa está ilustrada na Figura~\ref{mesalateral}.

Outra característica importante da mesa é a possibilidade de ser desmontada, o que facilita seu transporte. Apesar de possuir grandes medidas, uma vez desmontada pode ser facilmente carregada e armazenada, pois sua estrutura de alumínio é leve. Além disso, mesmo montada, a mesa possui rodas com travas para facilitar a movimentação, podendo ser travada no local de uso. A mesa completa pode ser observada, externa e internamente, nas Figuras~\ref{mesaporfora} e~\ref{mesadentro}, respectivamente.

\begin{figure}[h!]
	\centering
	\mbox{\subfigure{\includegraphics[scale=0.18]{mesapaisagem.jpg}}}
	\mbox{\subfigure{\includegraphics[scale=0.1]{mesaretrato.jpg}}
	\quad
	\subfigure{\includegraphics[scale=0.05]{mesaporfora.jpg}}}
	\caption{Fotos da mesa multi-toque construída neste projeto.}
	\label{mesaporfora}
\end{figure}

\begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=0.1]{mesapordentro.jpg}
	\caption{Visão interna da mesa, ilustrando seus componentes.}
	\label{mesadentro}
	\end{center}
\end{figure}

\begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=0.1]{ps3eyenosuporte.jpg}
	\caption{Câmera \textit{Playstation Eye} no suporte.}
	\label{ps3eyenosuporte}
	\end{center}
\end{figure}

\section{Superfície}
\label{cap4.2}

A superfície da mesa é feita de uma chapa de acrílico translúcido, que oferece uma alta resistência e transparência a um custo acessível. Seu coeficiente de refração é adequada e permite a iluminação de toda superfície. Sua transparência permite a captação dos toques com clareza pela câmera. O acrílico tem dimensões de 120 x 90 cm e espessura de 1 cm. Para reter a projeção é aplicado um papel vegetal sob a face interna do acrílico. O objetivo desta é impedir que a luz do canhão do projetor multimídia reflita no acrílico causando uma interferência detectável pela câmera. Além disso, ele ajuda a destacar a iluminação dos dedos, quando comparadas a da mão, facilitando a detecção de toques.

\section{Iluminação Infravermelha}
\label{cap4.3}

Para um reconhecimento satisfatório dos toques, foi utilizado o método de iluminação \textit{FTIR}, introduzido no capítulo anterior. Os \textit{LED}s infravermelhos foram posicionados em furos ao redor do acrílico apontados paralelamente a sua superfície (Figura~\ref{furosacrilico}). Aproveitando a resistência do acrílico, furou-se a lateral do acrílico a, aproximadamente, cada 1cm utilizando uma furadeira de bancada para o posicionamento e fixação dos \textit{LED}s. Foram realizados 200 furos no total, 115 em um dos lados da mesa com 120 cm e 85 em um dos lados com 90 cm. Os \textit{LED}s foram então inseridos nos furos e soldados (Figura~\ref{ledsolda}). Os \textit{LED}s são diodos de 5 mm de diâmetro com potência 1,1 w máxima, tendo a sua tensão máxima 5 V e corrente 220 mA. Como é utilizada uma fonte com tensão de 12,2 V, potência máxima de 60 w e corrente máxima de 5 A, os \textit{LED}s foram soldados de acordo com o diagrama da Figura~\ref{diagftir}, com séries de 8 \textit{LED}s e um resistor para regular a corrente, todas essas séries em paralelo entre si, de acordo com recomendação de uso dos \textit{LED}s calculada em~[\citenum{ledwizard}].

\begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=0.08]{furosacrilico(b).jpg}
	\caption{Furos efetuados na borda do acrílico.}
	\label{furosacrilico}
	\end{center}
\end{figure}

\begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=0.08]{ledsolda.jpg}
	\caption{\textit{LED}s soldados na borda do acrílico.}
	\label{ledsolda}
	\end{center}
\end{figure}

\begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=1]{circuito.jpg}
	\caption{Esquema de montagem do circuito dos \textit{LED}s infravermelhos.}
	\label{diagftir}
	\end{center}
\end{figure}


\section{Câmera}
\label{cap4.4}

Para capturar a imagem a ser processada de modo a identificar os toques sobre a superfície, foi utilizada uma câmera \textit{PlayStation Eye}, que pode ser observada na Figura~\ref{ps3eyenosuporte}. A escolha foi baseada no baixo custo da câmera, seu ângulo de abertura, pois permite a captura de imagens da superfície inteira com apenas uma câmera, e a alta taxa de frames por segundo em sua faixa de preço. Sua resolução pode ser configurada em 640 x 480 \textit{pixels}, ou em 320 x 240 \textit{pixels} numa taxa de atualização de 75 ou 120 frames por segundo, respectivamente.

Para capturar os movimentos sobre a mesa com maior precisão, modificou-se a câmera de modo a permitir a filtragem do espectro de luz visível e captar apenas luz infravermelha. Isto foi feito primeiro removendo o filtro nativo que a câmera possui, que bloqueava a iluminação infravermelha, e depois aplicando um filme fotográfico sobre a lente da câmera, que filtra a luz visível mas permite a passagem de luz infravermelha normalmente.

\section{Projetor}
\label{cap4.5}

Nesta mesa, o projetor utilizado é da marca \textit{BenQ} modelo \textit{MP772ST} (Figura~\ref{projetor}). Trata-se de um projetor \textit{WXGA}(\textit{Wide eXtended Graphics Array}) de resolução padrão 1024x768 pixels com suporte a projeção até 1080i. O projetor foi posicionado a uma distância de 90cm da superfície do acrílico. O projetor é fixado ao fundo da mesa e utiliza-se de um espelho para refletir a imagem até o topo, sobre o papel vegetal que se encontra diretamente abaixo da chapa de acrílico.

\begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=0.4]{BENQ_MP772_ST.jpg}
	\caption{Projetor multimídia \textit{BenQ MP772ST}~[\citenum{projpic}]}
	\label{projetor}
	\end{center}
\end{figure}

\section{Filtros de Processamento de Vídeo}
\label{cap4.6}

Para detectar corretamente os toques, é necessário processar cada imagem recebida pela câmera de forma a separar os toques das interferências das imagens de fundo. Para isso, utilizou-se uma cadeia de filtros disponíveis na biblioteca \textit{Community Core Vision} (\textit{CCV})~[\citenum{ccv}].

\begin{figure}[h!]
	\centering
	\mbox{\subfigure[Captura sem filtro]{\includegraphics[scale=0.25]{filtro1.png}}
	\quad
	\subfigure[Filtro de Eliminação do Fundo]{\includegraphics[scale=0.25]{filtro3.png}}
	\quad
	\subfigure[Filtro de Passo-alto]{\includegraphics[scale=0.25]{filtro4.png}}}
	\mbox{\subfigure[Filtro Amplificação]{\includegraphics[scale=0.25]{filtro5.png}}
	\quad
	\subfigure[Filtro de Retificação]{\includegraphics[scale=0.25]{filtro6.png}}}
	\caption{Aplicação dos filtros à imagem capturada pela câmera do sistema.}
	\label{filtros}
\end{figure}

A Figura~\ref{filtros}(a) mostra a captura direta da câmera, sem nenhum filtro de processamento aplicado, apenas o filtro de hardware apresentado na Seção~\ref{cap4.4}. Na Figura~\ref{filtros}(b), pode-se ver o filtro de eliminação de fundo, que guarda uma imagem inicial como referência e depois subtrai as imagens subsequentes, de modo a remover grande parte da interferência do fundo e de imperfeições do acrílico. Em seguida, na Figura~\ref{filtros}(c), é aplicado o filtro de passo-alto, que aumenta a luminosidade dos pontos que estão a determinada distância da câmera, removendo a luminosidade de pontos além destes, de modo a reduzir ruídos. Já na Figura~\ref{filtros}(d), tem-se o filtro amplificação, que intensifica a imagem obtida até o momento, proporcionando \textit{blobs} brilhosos e de fácil detecção. Finalmente, na Figura~\ref{filtros}(e), é aplicado o filtro de retificação, que elimina pequenas interferências restantes, pois filtra \textit{blobs} abaixo de um certo nível de tamanho. Neste caso, é imprescindível que somente os toques estejam visíveis, pois esta é a imagem usada para detectá-los.